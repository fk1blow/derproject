
<!-- saved from url=(0048)http://phrogz.net/tmp/canvas_copy_benchmark.html -->
<html><body><div class="webkit-line-gutter-backdrop"></div><table><tbody><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-doctype">&lt;!DOCTYPE HTML&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;html&gt;</span><span class="webkit-html-tag">&lt;head&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">	<span class="webkit-html-tag">&lt;title&gt;</span>Copying a section of a Canvas<span class="webkit-html-tag">&lt;/title&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">	<span class="webkit-html-tag">&lt;style <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/css</span>" <span class="webkit-html-attribute-name">media</span>="<span class="webkit-html-attribute-value">screen</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">		body { margin:2em 4em; background:#eee }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">		canvas { float:right; border:1px solid black }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">		#clipboards { clear:right; padding-top:1em; text-align:center; }</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">	<span class="webkit-html-tag">&lt;/style&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">	<span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/javascript</span>" <span class="webkit-html-attribute-name">charset</span>="<span class="webkit-html-attribute-value">utf-8</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">		var gkhead = new Image;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">		gkhead.src = 'gkhead.jpg';</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">		window.onload = function(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var canvas = document.getElementById('main');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var ctx = canvas.getContext('2d');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			canvas.width  = gkhead.width;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			canvas.height = gkhead.height;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			ctx.drawImage( gkhead, 0, 0 );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var copyBounds = {x1:200,y1:200,x2:325,y2:380};</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var w = copyBounds.x2 - copyBounds.x1;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var h = copyBounds.y2 - copyBounds.y1;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var offscreen = document.createElement('canvas');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			offscreen.width  = w;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			offscreen.height = h;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var offtx = offscreen.getContext('2d');</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			N = 10000;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var t1 = new Date;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			(function(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">				for (var i=0;i&lt;N;++i){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">					offtx.drawImage( canvas, copyBounds.x1, copyBounds.y1, w, h, 0, 0, w, h );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">				}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			})();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			console.log( "copy blit", N/(new Date-t1) );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var t1 = new Date;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			(function(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">				for (var i=0;i&lt;N;++i){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">					ctx.drawImage( offscreen, copyBounds.x1, copyBounds.y1 );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">				}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			})();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			console.log( "load blit", N/(new Date-t1) );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var imgd;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var t1 = new Date;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			(function(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">				for (var i=0;i&lt;N;++i){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">					imgd = ctx.getImageData( copyBounds.x1, copyBounds.y1, w, h );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">				}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			})();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			console.log( "getdata", N/(new Date-t1) );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			var t1 = new Date;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			(function(){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">				for (var i=0;i&lt;N;++i){</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">					ctx.putImageData( imgd, copyBounds.x1, copyBounds.y1 );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">				}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			})();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			console.log( "putdata", N/(new Date-t1) );</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">			</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">		};</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">	<span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/head&gt;</span><span class="webkit-html-tag">&lt;/body&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">	<span class="webkit-html-tag">&lt;canvas <span class="webkit-html-attribute-name">id</span>='<span class="webkit-html-attribute-value">main</span>'&gt;</span><span class="webkit-html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">	<span class="webkit-html-tag">&lt;p&gt;</span>Open the console log for benchmark information.<span class="webkit-html-tag">&lt;/p&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">	<span class="webkit-html-tag">&lt;div <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">clipboards</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">		<span class="webkit-html-tag">&lt;p&gt;</span>Results on OS X:<span class="webkit-html-tag">&lt;/p&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">		<span class="webkit-html-tag">&lt;p&gt;</span><span class="webkit-html-tag">&lt;img <span class="webkit-html-attribute-name">src</span>="<a class="webkit-html-attribute-value webkit-html-resource-link" target="_blank" href="http://phrogz.net/tmp/canvas_copy_benchmark.png">canvas_copy_benchmark.png</a>"&gt;</span><span class="webkit-html-tag">&lt;/p&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">	<span class="webkit-html-tag">&lt;/div&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/body&gt;</span><span class="webkit-html-tag">&lt;/html&gt;</span></td></tr></tbody></table></body></html>